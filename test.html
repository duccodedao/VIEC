<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Swap TON ‚Üí VIEC</title>
  <script src="https://unpkg.com/@tonconnect/sdk"></script>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; }
    .info { margin-top: 15px; background: #f0f0f0; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>Swap TON ‚Üí VIEC</h2>
  <p><strong>1 TON = 1000 VIEC</strong></p>

  <button id="connectButton">üîó K·∫øt n·ªëi v√≠ TON</button>
  <div id="walletInfo" class="info" style="display:none;"></div>

  <input type="number" id="amountTon" placeholder="Nh·∫≠p s·ªë TON mu·ªën swap" min="0.1" step="0.1" />

  <button id="swapButton">G·ª≠i TON v√† nh·∫≠n VIEC</button>

  <div id="jettonWalletInfo" class="info" style="display:none;"></div>

  <script>
    const connector = new TonConnect();
    const connectBtn = document.getElementById("connectButton");
    const swapBtn = document.getElementById("swapButton");
    const walletInfo = document.getElementById("walletInfo");
    const jettonWalletInfo = document.getElementById("jettonWalletInfo");

    let userAddress = null;

    // 1. K·∫øt n·ªëi v√≠
    connectBtn.onclick = async () => {
      await connector.restoreConnection();
      const wallet = await connector.connectWallet();
      userAddress = wallet.account.address;

      walletInfo.style.display = "block";
      walletInfo.innerHTML = `<strong>ƒê√£ k·∫øt n·ªëi v√≠:</strong><br>${userAddress}`;
    };

    // 2. G·ª≠i TON v√† hi·ªán Jetton Wallet Address
    swapBtn.onclick = async () => {
      if (!userAddress) return alert("H√£y k·∫øt n·ªëi v√≠ tr∆∞·ªõc.");

      const tonAmount = parseFloat(document.getElementById("amountTon").value);
      if (!tonAmount || tonAmount <= 0) return alert("S·ªë TON kh√¥ng h·ª£p l·ªá.");

      const nanoTon = (tonAmount * 1e9).toFixed(0);

      // ƒê·ªãa ch·ªâ v√≠ b·∫°n
      const yourAddress = "UQDu8vyZSZbAYvRRQ_jW4_0EiBGibAGq72wSZjYWRmNAGhRD";

      // 3. G·ª≠i giao d·ªãch
      try {
        await connector.sendTransaction({
          validUntil: Math.floor(Date.now() / 1000) + 600,
          messages: [{
            address: yourAddress,
            amount: nanoTon,
            payload: "" // c√≥ th·ªÉ th√™m ghi ch√∫
          }]
        });
        alert("G·ª≠i TON th√†nh c√¥ng. B·∫°n s·∫Ω nh·∫≠n VIEC s·ªõm!");

        // 4. G·ªçi tonapi.io ƒë·ªÉ l·∫•y Jetton Wallet Address
        const jettonMaster = "EQA5JIIDkiPljbagP_S9R7fZQLAhLZjNhIPRVSWkuicj5M_f";
        const apiUrl = `https://tonapi.io/v2/jettons/wallets/${userAddress}?jetton=${jettonMaster}`;

        const res = await fetch(apiUrl);
        const data = await res.json();
        const jettonWalletAddress = data?.address;

        if (jettonWalletAddress) {
          jettonWalletInfo.style.display = "block";
          jettonWalletInfo.innerHTML = `
            <strong>ƒê·ªãa ch·ªâ Jetton Wallet (VIEC) c·ªßa b·∫°n:</strong><br>
            ${jettonWalletAddress}<br>
            <br><i>Ch√∫ng t√¥i s·∫Ω g·ª≠i ${tonAmount * 1000} VIEC ƒë·∫øn ƒë·ªãa ch·ªâ n√†y.</i>
          `;
        } else {
          jettonWalletInfo.innerHTML = "‚ùå Kh√¥ng t√¨m th·∫•y Jetton Wallet VIEC.";
        }

      } catch (e) {
        console.error(e);
        alert("G·ª≠i TON th·∫•t b·∫°i ho·∫∑c b·ªã hu·ª∑.");
      }
    };
  </script>
</body>
</html>
