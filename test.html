<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>VIEC DEX - Swap TON ‚Üî VIEC</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f3f3;
      padding: 20px;
      text-align: center;
    }
    .balance {
      margin-top: 20px;
      font-size: 18px;
    }
    iframe {
      width: 100%;
      max-width: 500px;
      height: 500px;
      border: none;
      border-radius: 20px;
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h1>üåê VIEC DEX</h1>
  <div id="ton-connect-button"></div>

  <div class="balance" id="balances">
    ƒêang ki·ªÉm tra s·ªë d∆∞ v√≠...
  </div>

  <iframe src="https://app.ston.fi/swap?from=TON&to=EQA5JIIDkiPljbagP_S9R7fZQLAhLZjNhIPRVSWkuicj5M_f&amount=1&slippage=1"
          allow="clipboard-write"
          loading="lazy">
  </iframe>

  <script type="module">
    import { TonConnectUI } from "https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js";

    const tonConnectUI = new TonConnectUI({
      manifestUrl: 'https://ton-connect.github.io/demo-dapp-with-react-ui/tonconnect-manifest.json',
      buttonRootId: 'ton-connect-button',
    });

    // L·∫•y s·ªë d∆∞
    async function fetchBalances() {
      const connectedWallet = await tonConnectUI.connectedWallet;
      if (!connectedWallet) {
        document.getElementById("balances").innerText = "Vui l√≤ng k·∫øt n·ªëi v√≠ ƒë·ªÉ xem s·ªë d∆∞.";
        return;
      }

      const walletAddress = connectedWallet.account.address;
      const apiUrl = `https://tonapi.io/v2/accounts/${walletAddress}/jettons`;

      const res = await fetch(apiUrl);
      const data = await res.json();
      let tonBalance = parseFloat(data.balance.coins) / 1e9;
      let viecBalance = "0";

      for (const jetton of data.balances) {
        if (jetton.jetton.master === "EQA5JIIDkiPljbagP_S9R7fZQLAhLZjNhIPRVSWkuicj5M_f") {
          viecBalance = parseFloat(jetton.balance) / 1e9;
        }
      }

      document.getElementById("balances").innerText =
        `S·ªë d∆∞ TON: ${tonBalance.toFixed(3)} | S·ªë d∆∞ VIEC: ${viecBalance}`;
    }

    setInterval(fetchBalances, 5000);
    fetchBalances();
  </script>

</body>
</html>
