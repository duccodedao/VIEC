<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TON Wallet Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- TON Libraries -->
  <script src="https://unpkg.com/@ton/crypto@latest"></script>
  <script src="https://unpkg.com/@ton/core@latest"></script>
  <script src="https://unpkg.com/@ton/ton@latest"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f7f9fc; }
    h2 { color: #007acc; }
    textarea, input { width: 100%; padding: 10px; margin: 5px 0; font-size: 14px; }
    button { padding: 10px 20px; margin: 10px 0; background: #007acc; color: white; border: none; cursor: pointer; }
    .box { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px #ccc; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>ü¶Ñ TON Wallet Web</h2>

  <button onclick="createWallet()">T·∫°o v√≠ m·ªõi</button>
  <button onclick="loadWallet()">ƒêƒÉng nh·∫≠p b·∫±ng private key</button>

  <div id="wallet" class="box" style="display:none;">
    <h3>üéí V√≠ c·ªßa b·∫°n</h3>
    <p><b>ƒê·ªãa ch·ªâ:</b> <span id="wallet-address"></span></p>
    <p><b>S·ªë d∆∞:</b> <span id="wallet-balance"></span> TON</p>

    <h4>G·ª≠i TON ho·∫∑c Jetton</h4>
    <input type="text" id="to-address" placeholder="ƒê·ªãa ch·ªâ ng∆∞·ªùi nh·∫≠n">
    <input type="number" id="amount" placeholder="S·ªë TON ho·∫∑c Jetton">
    <input type="text" id="jetton" placeholder="Jetton Address (ƒë·ªÉ tr·ªëng n·∫øu g·ª≠i TON)">
    <button onclick="send()">G·ª≠i</button>
  </div>

  <div class="box" id="keys-box" style="display:none;">
    <h4>üîê Private Key ho·∫∑c Seed</h4>
    <textarea id="wallet-keys" rows="4"></textarea>
  </div>

  <script>
    const { mnemonicNew, mnemonicToPrivateKey } = tonCrypto;
    const { TonClient, WalletContractV4, Address, fromNano, toNano } = ton;

    let client, wallet;

    async function createWallet() {
      const mnemonics = await mnemonicNew(24);
      const key = await mnemonicToPrivateKey(mnemonics);
      wallet = WalletContractV4.create({ workchain: 0, publicKey: key.publicKey });
      localStorage.setItem("pk", Buffer.from(key.secretKey).toString("hex"));

      document.getElementById("wallet-keys").value = mnemonics.join(" ");
      document.getElementById("keys-box").style.display = "block";
      await showWallet();
    }

    async function loadWallet() {
      const pk = prompt("Nh·∫≠p private key (hex):");
      if (!pk) return;
      const key = {
        publicKey: tonCrypto.keyPairFromSecretKey(Buffer.from(pk, "hex")).publicKey,
        secretKey: Buffer.from(pk, "hex")
      };
      wallet = WalletContractV4.create({ workchain: 0, publicKey: key.publicKey });
      localStorage.setItem("pk", pk);
      await showWallet();
    }

    async function showWallet() {
      client = new TonClient({ endpoint: "https://toncenter.com/api/v2/jsonRPC" });

      const addr = wallet.address.toString({ testOnly: false });
      document.getElementById("wallet-address").textContent = addr;

      const balance = await client.getBalance(wallet.address);
      document.getElementById("wallet-balance").textContent = fromNano(balance);

      document.getElementById("wallet").style.display = "block";
    }

    async function send() {
      const to = document.getElementById("to-address").value;
      const amount = document.getElementById("amount").value;
      const jetton = document.getElementById("jetton").value;

      const seqno = await wallet.getSeqno(client);
      const secretKey = Buffer.from(localStorage.getItem("pk"), "hex");
      const keyPair = tonCrypto.keyPairFromSecretKey(secretKey);

      if (!jetton) {
        // G·ª≠i TON
        await wallet.sendTransfer({
          secretKey,
          seqno,
          messages: [{
            to: Address.parse(to),
            value: toNano(amount),
            body: null
          }]
        }, client);
        alert("ƒê√£ g·ª≠i TON!");
      } else {
        // G·ª≠i Jetton
        const { JettonWallet } = ton;
        const jettonWallet = await JettonWallet.create(client, Address.parse(jetton), wallet.address);
        await jettonWallet.sendTransfer({
          secretKey,
          to: Address.parse(to),
          amount: toNano(amount),
          seqno
        });
        alert("ƒê√£ g·ª≠i Jetton!");
      }

      await showWallet();
    }
  </script>
</body>
</html>
